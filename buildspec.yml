version: 0.2

phases:
  install:
    commands:
      - npm -g install typescript
      - npm update -g typescript
      - npm install -g aws-cdk
  build:
    commands:
      - cd source/cdk
      - npm install
      - cd ..
      - cd custom-resource
      - npm install
      - cd ../job-submit
      - npm install
      - cd ../../deployment
      - chmod +x ./run-unit-tests.sh
      - ./run-unit-tests.sh
      - cd ../source/cdk
      - cdk deploy "streaming-mutable-*" --require-approval never
